**堆内存图**

堆内存（Heap）的结构与栈（Stack）完全不同。栈是后进先出、有固定顺序的，而堆则是一个大空间，其中的内存是**动态分配**和**无序的**。

你可以把堆想象成一个**巨大的仓库**。当你需要存储一个物品（数据）时，你向仓库管理员（操作系统）申请一块空间。仓库管理员会在仓库的任意一个空闲位置给你分配一个货位，并给你这个货位的地址。当你不再需要这个物品时，你需要告诉仓库管理员回收这块空间。

下面是一个简单的堆内存分配过程图示：

---


## 特点

1. 动态分配，无序
2. 需要申请向操作系统申请和手动释放

### 初始状态

假设堆内存是一大片空地。

```
[                      ]
[                      ]
[                      ]
[                      ]  <-- 大片空闲的堆内存
[                      ]
```

### 1. 分配变量 `a`

你在程序中创建了一个变量 `a`，它需要存储在堆上。操作系统找到一块空闲位置，将数据存入，并返回一个地址给 `a`。

```
[                      ]
[                      ]
[                      ]
[                      ]
[      a (地址: 0x1001)  ]   <-- 内存块被分配给 `a`
```

_注意：`a` 变量本身（指针）可能存储在栈上，但它指向的数据存储在堆上。_

### 2. 分配变量 `b`

接着，你又创建了变量 `b`。操作系统可能在另一个空闲位置分配内存。这块内存**不一定**紧挨着 `a`。

```
[        b (地址: 0x2005) ]   <-- `b` 在另一个位置
[                      ]
[                      ]
[                      ]
[      a (地址: 0x1001)  ]
```

---

**核心区别：**

- **栈**：像叠盘子一样，有序、自上而下、后进先出。
    
- **堆**：像一个自由分配的大空间，无序、动态、需要手动管理（例如用 `malloc` 和 `free` 或垃圾回收机制）。
    

堆的这种特性使得它非常适合存储**大小不确定**或者**生命周期不确定**的数据，例如对象、动态数组等。